<div class="container-fluid mt-5">
  <div class="row">
    <div class="col-12">

      <!-- Título -->
      <h2 class="mb-4 text-center">
        <i class="bi bi-list"></i> Lista de Productos
      </h2>

      <!-- Buscador -->
      <div class="mb-4 d-flex justify-content-center align-items-center">
        <input
          type="text"
          class="form-control w-50"
          placeholder="Buscar"
          (keyup)="filter($event)"
          [(ngModel)]="strFiltro"
        />

        <div class="d-inline-flex mx-2">
          <nav class="my-4">
            <ul class="pagination justify-content-center">
              <li class="page-item" [class.active]="nRpp === 10">
                <a class="page-link" (click)="goToRpp(10)" href="#">10</a>
              </li>
              <li class="page-item" [class.active]="nRpp === 50">
                <a class="page-link" (click)="goToRpp(50)" href="#">50</a>
              </li>
              <li class="page-item" [class.active]="nRpp === 100">
                <a class="page-link" (click)="goToRpp(100)" href="#">100</a>
              </li>
            </ul>
          </nav>
        </div>

      </div>

      <!-- Info filtro y cantidad -->
      <div class="d-flex justify-content-between">
        @if (strFiltro.length > 0) {
          <h5 class="text-muted">
            Filtrado por: <span class="text-danger">{{ strFiltro }}</span>
          </h5>
        } @else {
          <h5 class="text-muted">Sin filtrar</h5>
        }
        <h5 class="text-muted">
          Mostrando {{ oPage?.numberOfElements | number: '1.0-0' }} de {{ oPage?.totalElements | number: '1.0-0' }}
        </h5>
      </div>

      <!-- Loader -->
      <div *ngIf="loading" class="text-center my-4">
        <div class="spinner-border text-success" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
      </div>

      <!-- Tabla -->
      <div class="table-responsive" *ngIf="!loading">
        <table class="table table-striped table-bordered align-middle text-center">
          <thead class="table-success text-white bg-success">
            <tr>
              <th>ID</th>
              <th>Descripción</th>
              <th>Descripción TIC</th>
              <th>Departamento</th>
              <th>Familia</th>
              <th>Subfamilia</th>
              <th>Marca</th>
              <th>Unidad de Medida</th>
              <th>Cantidad</th>
              <th>Centralizado</th>
              <th>Apeso</th>
              <th>Unidad Caja</th>
              <th>Unidad Servicio</th>
              <th>PK</th>
              <th>Cajas Capa</th>
              <th>Cajas Palet</th>
              <th>Proveedor</th>
              <th>Referencia Proveedor</th>
              <th>EAN</th>
              <th>EAN C</th>
              <th>EAN P</th>
              <th>Largo</th>
              <th>Ancho</th>
              <th>Alto</th>
              <th>Peso</th>
              <th>Días Caducidad</th>
              <th>ARA CEN</th>
              <th>IVA</th>
              <th>Precio Venta</th>
              <th>PVP HOM</th>
              <th>PVP AND</th>
              <th>PVP CAT</th>
              <th>Precio Tarifa</th>
              <th>PRO FAC</th>
              <th>Precio Neto</th>
              <th>PRO FFAC</th>
              <th>PRO NETON</th>
              <th>ART MKD</th>
              <th>Articulo Sustituido</th>
              <th>Insertado por</th>
              <th>Actualizado por</th>
              <th>Status</th>
              <th>Observaciones</th>
              <th>Partida Arancelaria</th>
              <th>PVP MEL</th>
              <th>País Origen</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let producto of oPage?.content" class="clickable-row" (click)="edit(producto)">
              <td [ngClass]="getCellClass(producto.id)">{{ getCellDisplay(producto.id)}}</td>
              <td [ngClass]="getCellClass(producto.descripcion)">{{ getCellDisplay(producto.descripcion)}}</td>
              <td [ngClass]="getCellClass(producto.descripcionTic)">{{ getCellDisplay(producto.descripcionTic)}}</td>
              <td [ngClass]="getCellClass(producto.departamento)">{{ getCellDisplay(producto.departamento)}}</td>
              <td [ngClass]="getCellClass(producto.familia)">{{ getCellDisplay(producto.familia)}}</td>
              <td [ngClass]="getCellClass(producto.subfamilia)">{{ getCellDisplay(producto.subfamilia)}}</td>
              <td [ngClass]="getCellClass(producto.marca)">{{ getCellDisplay(producto.marca)}}</td>
              <td [ngClass]="getCellClass(producto.unidadDeMedida)">{{ getCellDisplay(producto.unidadDeMedida)}}</td>
              <td [ngClass]="getCellClass(producto.cantidad)">{{ getCellDisplay(producto.cantidad)}}</td>
              <td [ngClass]="getCellClass(producto.centralizado)">{{ getCellDisplay(producto.centralizado)}}</td>
              <td [ngClass]="getCellClass(producto.apeso)">{{ getCellDisplay(producto.apeso)}}</td>
              <td [ngClass]="getCellClass(producto.unidadDeCaja)">{{ getCellDisplay(producto.unidadDeCaja)}}</td>
              <td [ngClass]="getCellClass(producto.unidadDeServicio)">{{ getCellDisplay(producto.unidadDeServicio)}}</td>
              <td [ngClass]="getCellClass(producto.pk)">{{ getCellDisplay(producto.pk)}}</td>
              <td [ngClass]="getCellClass(producto.cajasCapa)">{{ getCellDisplay(producto.cajasCapa)}}</td>
              <td [ngClass]="getCellClass(producto.cajasPalet)">{{ getCellDisplay(producto.cajasPalet)}}</td>
              <td [ngClass]="getCellClass(producto.proveedor)">{{ getCellDisplay(producto.proveedor)}}</td>
              <td [ngClass]="getCellClass(producto.referenciaProveedor)">{{ getCellDisplay(producto.referenciaProveedor)}}</td>
              <td [ngClass]="getCellClass(producto.ean)">{{ getCellDisplay(producto.ean)}}</td>
              <td [ngClass]="getCellClass(producto.ean_c)">{{ getCellDisplay(producto.ean_c)}}</td>
              <td [ngClass]="getCellClass(producto.ean_p)">{{ getCellDisplay(producto.ean_p)}}</td>
              <td [ngClass]="getCellClass(producto.largo)">{{ getCellDisplay(producto.largo)}}</td>
              <td [ngClass]="getCellClass(producto.ancho)">{{ getCellDisplay(producto.ancho)}}</td>
              <td [ngClass]="getCellClass(producto.alto)">{{ getCellDisplay(producto.alto)}}</td>
              <td [ngClass]="getCellClass(producto.peso)">{{ getCellDisplay(producto.peso)}}</td>
              <td [ngClass]="getCellClass(producto.diasCaducidad)">{{ getCellDisplay(producto.diasCaducidad)}}</td>
              <td [ngClass]="getCellClass(producto.ara_cen)">{{ getCellDisplay(producto.ara_cen)}}</td>
              <td [ngClass]="getCellClass(producto.iva)">{{ getCellDisplay(producto.iva)}}</td>
              <td [ngClass]="getCellClass(producto.precioVenta)">{{ getCellDisplay(producto.precioVenta)}}</td>
              <td [ngClass]="getCellClass(producto.pvp_hom)">{{ getCellDisplay(producto.pvp_hom)}}</td>
              <td [ngClass]="getCellClass(producto.pvp_and)">{{ getCellDisplay(producto.pvp_and)}}</td>
              <td [ngClass]="getCellClass(producto.pvp_cat)">{{ getCellDisplay(producto.pvp_cat)}}</td>
              <td [ngClass]="getCellClass(producto.precioTarifa)">{{ getCellDisplay(producto.precioTarifa)}}</td>
              <td [ngClass]="getCellClass(producto.pro_fac)">{{ getCellDisplay(producto.pro_fac)}}</td>
              <td [ngClass]="getCellClass(producto.precioNeto)">{{ getCellDisplay(producto.precioNeto)}}</td>
              <td [ngClass]="getCellClass(producto.pro_ffac)">{{ getCellDisplay(producto.pro_ffac)}}</td>
              <td [ngClass]="getCellClass(producto.pro_neton)">{{ getCellDisplay(producto.pro_neton)}}</td>
              <td [ngClass]="getCellClass(producto.art_mkd)">{{ getCellDisplay(producto.art_mkd)}}</td>
              <td [ngClass]="getCellClass(producto.articuloSustituido)">{{ getCellDisplay(producto.articuloSustituido)}}</td>
              <td [ngClass]="getCellClass(producto.insertedBy)">{{ getCellDisplay(producto.insertedBy)}}</td>
              <td [ngClass]="getCellClass(producto.updateBy)">{{ getCellDisplay(producto.updateBy)}}</td>
              <td [ngClass]="getCellClass(producto.status)">{{ getCellDisplay(producto.status) }}</td>
              <td [ngClass]="getCellClass(producto.observaciones)">{{ getCellDisplay(producto.observaciones)}}</td>
              <td [ngClass]="getCellClass(producto.partidaArancelaria)">{{ getCellDisplay(producto.partidaArancelaria)}}</td>
              <td [ngClass]="getCellClass(producto.pvp_mel)">{{ getCellDisplay(producto.pvp_mel)}}</td>
              <td [ngClass]="getCellClass(producto.paisOrigen)">{{ getCellDisplay(producto.paisOrigen)}}</td>
              <td>
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-success" (click)="view(producto); $event.stopPropagation()">
                    <i class="bi bi-eye"></i>
                  </button>
                  <button class="btn btn-warning" (click)="edit(producto); $event.stopPropagation()">
                    <i class="bi bi-pencil-square"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Paginación -->
      <nav class="mt-3">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="nPage <= 0">
            <a class="page-link" (click)="goToPrev()">Anterior</a>
          </li>
          <li class="page-item" *ngFor="let p of arrBotonera" [class.active]="nPage === (+p - 1)">
            <ng-container *ngIf="p === '...'; else numPage">
              <span class="page-link disabled">…</span>
            </ng-container>
            <ng-template #numPage>
              <a class="page-link" href="#" (click)="goToPage(p)">{{ p }}</a>
            </ng-template>
          </li>
          <li class="page-item" [class.disabled]="oPage && nPage >= oPage.totalPages - 1">
            <a class="page-link" (click)="goToNext()">Siguiente</a>
          </li>
        </ul>

        <!-- Ir a página -->
        <div class="pagination-container mt-3">
          <div class="go-to-page-container">
            <label for="goToPage">Ir a la página:</label>
            <input
              id="goToPage"
              type="number"
              min="1"
              [max]="oPage?.totalPages || 1"
              [(ngModel)]="customPage"
              class="go-to-page-input"
              [class.invalid]="isInvalidCustomPage()"
              (keyup.enter)="goToCustomPage()"
            />
            <button
              (click)="goToCustomPage()"
              class="go-to-page-button"
              [disabled]="isInvalidCustomPage()"
            >
              Ir
            </button>
          </div>
        </div>
      </nav>

    </div>
  </div>
</div>
