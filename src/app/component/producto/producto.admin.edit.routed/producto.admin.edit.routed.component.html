<div class="container py-4">
  <h2 class="text-center mb-4">Editar Producto</h2>

  <form [formGroup]="oProductoForm" (ngSubmit)="onSubmit()" *ngIf="oProducto">
    <div *ngFor="let key of camposProducto" class="mb-3">
      <label class="form-label fw-bold">{{ key }}</label>

      <input
        *ngIf="key !== 'observaciones' && key !== 'descripcion'"
        class="form-control"
        [formControlName]="key"
        [readonly]="key === 'codigo'"
      />

      <textarea
        *ngIf="key === 'observaciones' || key === 'descripcion'"
        class="form-control"
        [formControlName]="key"
      ></textarea>
    </div>

    <div
      class="mb-4"
      *ngIf="oProducto && oProducto.imagenes && oProducto.imagenes.length > 0"
    >
      <label class="form-label fw-bold">Imágenes actuales</label>
      <div class="d-flex flex-wrap gap-3 justify-content-center">
        <div *ngFor="let img of oProducto.imagenes" class="position-relative">
          <img
            [src]="'http://localhost:8086' + img.imagenUrl"
            alt="Imagen"
            width="100"
            height="100"
            class="rounded shadow border"
          />
          <button
            type="button"
            class="btn btn-danger btn-sm position-absolute top-0 end-0 translate-middle rounded-circle"
            (click)="eliminarImagen(img.id)"
            style="width: 24px; height: 24px; line-height: 0.9"
            title="Eliminar imagen"
          >
            &times;
          </button>
        </div>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">País de Origen</label>
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Selecciona un país</mat-label>
        <mat-select
          formControlName="paisOrigen"
          panelClass="pais-dropdown-panel"
        >
          <mat-option *ngFor="let pais of paisesList" [value]="pais.codigo">
            <div class="d-flex justify-content-between">
              <span>{{ pais.nombre }}</span>
              <span class="text-muted ms-2">({{ pais.codigo }})</span>
            </div>
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">Cambiar imagen</label>
      <input
        type="file"
        (change)="onFileChange($event)"
        accept=".png,.jpg,.jpeg,.webp"
        class="form-control"
      />
    </div>

    <div *ngIf="imagenPreview" class="mb-4 text-center">
      <label class="form-label fw-bold">Vista previa de nueva imagen</label>
      <img
        [src]="imagenPreview"
        alt="Vista previa"
        width="120"
        height="120"
        class="rounded shadow border border-info"
      />
    </div>

    <div class="d-flex justify-content-evenly mt-4">
      <button
        class="btn btn-warning"
        type="button"
        [routerLink]="['/admin', 'producto', 'plist']"
      >
        Volver al listado
      </button>
      <button class="btn btn-success" type="submit">Guardar cambios</button>
    </div>
  </form>

  <!-- Modal -->
  <div
    class="modal fade"
    [id]="'mimodal'"
    tabindex="-1"
    aria-labelledby="exampleModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Mensaje</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
            (click)="hideModal()"
          ></button>
        </div>
        <div class="modal-body text-center">
          <p class="fs-5">{{ strMessage }}</p>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-primary"
            data-bs-dismiss="modal"
            (click)="hideModal()"
          >
            Cerrar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
